<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>新闻</title>
	<!--<link rel="stylesheet" href="/static/css/bootstrap.min.css">-->
	<link rel="stylesheet" href="../static/css/bootstrap.min.css">
<style>
	body {
		padding-top: 70px;
	}
</style>
</head>
<body>
<nav class="navbar navbar-default navbar-fixed-top">
	<div class="container-fluid">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#nav-body" aria-expanded="false">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="javascript:void(0)">新闻</a>
		</div>
		<div class="collapse navbar-collapse" id="nav-body">
			<ul class="nav navbar-nav">
				<!--<li><a href="javascript:void(0)">Test</a></li>-->
			</ul>
		</div>
	</div>
</nav>
<div class="container-fluid" id="main-body">
	<div class="row">
		<!--<div class="col-md-3"></div>-->
		<div class="col-sm-offset-2 col-sm-8">
			<ul class="list-group">
				<li class="list-group-item"><div id="china-map" style="height: 800px; width: 100%;"></div></li>
			</ul>
			<!--<ul class="list-group">-->
				<!--<li class="list-group-item"><div style="height: 800px; width: 100%;">hahaha</div></li>-->
			<!--</ul>-->
			<ul class="list-group">
				<li class="list-group-item"><div id="word-cloud" style="height: 800px; width: 100%;"></div></li>
			</ul>
		</div>
	</div>
</div>
<div id="test"></div>
<!--<script src="/static/js/jquery-1.11.1.min.js"></script>-->
<!--<script src="/static/js/echarts.min.js"></script>-->
<!--<script src="/static/js/china.js"></script>-->
<!--<script src="/static/js/bootstrap.min.js"></script>-->
<!--<script src="/static/js/echarts-wordclound.min.js"></script>-->
<!--<script src="/static/js/vue.min.js"></script>-->
<script src="../static/js/jquery-1.11.1.min.js"></script>
<script src="../static/js/echarts.min.js"></script>
<script src="../static/js/china.js"></script>
<script src="../static/js/bootstrap.min.js"></script>
<script src="../static/js/echarts-wordclound.min.js"></script>
<script src="../static/js/vue.min.js"></script>
<script>
$(function(){
	new Vue({
		el: '#main-body',
		data(){
			return {
				cza: '',
			}
		},
		mounted(){
			this.init_pic('/api/get/map/data', {});
			//this.draw_china_map('china-map', '/api/get/china/map/data', {});
			//this.draw_wordCloud('word-cloud', '/api/get/world/cloud/data', {});
		},
		methods: {
			init_pic: function(api, params){
				var
					myChart1 = echarts.init(document.getElementById('china-map')),
					myChart2 = echarts.init(document.getElementById('word-cloud'));
				myChart1.showLoading();
				myChart2.showLoading();
				$.get(api, params, (api_result) => {
					this.init_china_map(myChart1, api_result);
					this.init_word_cloud(myChart2, api_result);
				})
			},
			init_china_map: function(myChart, api_result){
				var option = {
					title: {
						text: '新闻热度图'
					},
					tooltip: {
					},
					visualMap: {
						show: true,
						x: 'right',
						y: 'top',
						splitList: api_result.bar,
						color: ['#B71C1C', '#FFB74D', '#90CAF9', '#A5D6A7']
					},
					series: [
						{
							name: '新闻更新量',
							type: 'map',
							mapType: 'china',
							selectedMode: 'multiple',
							label: {
								normal: {
									show: true,
								},
								emphasis: {
									show: true,
								}
							},
							itemStyle: {
								normal: {
									borderWidth: .5,
								},
								emphasis: {
									borderWidth: .5,
									borderColor: '#4b0082',
									areaColor: "#ffdead",
								}
							},
							data: api_result.map_data,
						}
					]
				};
				myChart.hideLoading();
				myChart.setOption(option);
			},
			init_word_cloud: function(myChart, api_result){
					var
						data = api_result.cloud_data,
						maskImage = new Image(),
						option = {
							series: [{
								type: 'wordCloud',
								sizeRange: [10, 100],
								rotationRange: [-90, 90],
								rotationStep: 45,
								gridSize: 2,
								shape: 'pentagon',
								maskImage: maskImage,
								textStyle: {
									normal: {
										color: function () {
											return 'rgb(' + [
												Math.round(Math.random() * 160),
												Math.round(Math.random() * 160),
												Math.round(Math.random() * 160)
											].join(',') + ')';
										}
									}
								},
								data: data.sort(function (a, b) {
									return b.value  - a.value;
								})
							}],
						};
					maskImage.onload = function () {
						myChart.hideLoading();
						option.series[0].maskImage
						myChart.setOption(option);
					}
					maskImage.src = '../static/img/logo.png';
			},
			draw_china_map: function(id, api, params, option){
				var myChart = echarts.init(document.getElementById(id));
				myChart.showLoading();
				$.get(api, params, (api_result) => {
					var _option = {
						title: {
							text: '新闻热度图'
						},
						tooltip: {
						},
						visualMap: {
							show: true,
							x: 'right',
							y: 'top',
							splitList: api_result.bar,
							color: ['#B71C1C', '#FFB74D', '#90CAF9', '#A5D6A7']
						},
						series: [
							{
								name: '新闻更新量',
								type: 'map',
								mapType: 'china',
								selectedMode: 'multiple',
								label: {
									normal: {
										show: true,
									},
									emphasis: {
										show: true,
									}
								},
								itemStyle: {
									normal: {
										borderWidth: .5,
									},
									emphasis: {
										borderWidth: .5,
										borderColor: '#4b0082',
										areaColor: "#ffdead",
									}
								},
								data: api_result.map_data,
							}
						]
					};
					myChart.hideLoading();
					myChart.setOption(option || _option);
				})
			},
			draw_wordCloud: function(id, api, params){
				$.get(api, params, (api_result) => {
					var
						chart = echarts.init(document.getElementById(id)),
						data = api_result.cloud_data,
						maskImage = new Image(),
						option = {
							series: [{
								type: 'wordCloud',
								sizeRange: [10, 100],
								rotationRange: [-90, 90],
								rotationStep: 45,
								gridSize: 2,
								shape: 'pentagon',
								maskImage: maskImage,
								textStyle: {
									normal: {
										color: function () {
											return 'rgb(' + [
												Math.round(Math.random() * 160),
												Math.round(Math.random() * 160),
												Math.round(Math.random() * 160)
											].join(',') + ')';
										}
									}
								},
								data: data.sort(function (a, b) {
									return b.value  - a.value;
								})
							}],
						};
					maskImage.onload = function () {
						option.series[0].maskImage
						chart.setOption(option);
					}
					maskImage.src = '../static/img/logo.png';
				})
			},
		},
	})
})
</script>
</body>
</html>